import $ from "jquery"

function scrollsY(box){
	var pointY = 0, top = 0;
	var indexObj;
	box = box || ".ovy-a";
	var that = box;
	$(box).each(function(){
		var box = $(this);
		var H = box[0].clientHeight;
		if (H == 0) return;
		var needCur = 18;
		H = H - needCur;
		var cententH = box.children()[0].clientHeight;
		var btnH = box[0].clientHeight / cententH * H;
		var scrollY = '<div class="scroll_box" move="false"><div class="scrollY_btn" tops="0"></div></div>';
		box.parent().css({"position":"relative"});
		var siblings = box.siblings('.scroll_box');
		if(H / cententH <= 1){
			if (siblings.length) {
				siblings.show();
			} else {
				box.before(scrollY);
			}
		}else{
			siblings.hide();
		}
		box.siblings(".scroll_box").css({
			"height": H
		}).attr({
			'boxH': H,
			'cententH': cententH
		});
		box.siblings(".scroll_box").children(".scrollY_btn").css({
			"height": btnH
		}).attr({
			'tops': H / cententH
		});
		addscroll(box);
		$(".scrollY_btn").mousedown(function(e){
			indexObj=$(this);
			pointY = e.pageY;	//这里可以得到鼠标Y坐标
			top = $(this).attr("tops") * 1;
			$(this).parent().attr("move","true");
			$(this).focus();
		});
		$(document).mousemove(function(e){
			e.stopPropagation();
			if(indexObj!=undefined && indexObj.parent().attr("move")=="true"){
				var moveY =e.pageY-pointY;
				var boxH=indexObj.parent().attr("boxH")
				var cententH=indexObj.parent().attr("cententH");
				var btnH=boxH/cententH*boxH;
				indexObj.siblings().unbind();
				indexObj.css({
					"margin-top":top+moveY
				}).attr("tops",top+moveY);
				indexObj.parent().siblings().scrollTop((top+moveY)/boxH*cententH);
				if(top+moveY>boxH-btnH){
					indexObj.css({
						"margin-top":boxH-btnH
					}).attr("tops",boxH-btnH);
				}else if(top+moveY<0){
					indexObj.css({
						"margin-top":0
					}).attr("tops",0);
				}
			}
		});
		$(document).mouseup(function(e){
			if(indexObj!=undefined){
				indexObj.parent().attr("move","false")
				addscroll(box);
			}
		});
	});
	function addscroll(box){
		box.scroll(function(){
			var Y=$(this).scrollTop();
			var boxH=$(this).siblings(".scroll_box").attr("boxH")
			var cententH=$(this).siblings(".scroll_box").attr("cententH");
			$(this).siblings(".scroll_box").children(".scrollY_btn").css({
				"margin-top":Y/cententH*boxH
			}).attr("tops",Y/cententH*boxH);
		});
	}
}

export default scrollsY